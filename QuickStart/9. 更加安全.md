# ğŸš€ CryptoVerifier

---

## ä¸€äº›ç¤ºä¾‹

Bad:

```java
public class Test {
    public static void main(String[] args) {
        if (!handleLicense()) {
            return;
        }

        start();
    }

    private static boolean handleLicense() {
        // å¤„ç†è®¸å¯è¯
        return true;
    }

    private static void start() {
        // æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    }
}
```

è¿™ç»å¯¹æ˜¯æ¯”è¾ƒç³Ÿç³•çš„å†™æ³•ï¼Œå°½ç®¡å®ƒçœ‹èµ·æ¥å¾ˆæ¸…æ™°ï¼Œä½†æ˜¯é»‘å®¢åªéœ€è¦é€šè¿‡ä¿®æ”¹å­—èŠ‚ç å†™ç©ºæ‚¨çš„è®¸å¯è¯å¤„ç†æ–¹æ³•ï¼Œæ›´æ”¹è¿”å›å€¼å³å¯ç ´è§£ã€‚

Better:

```java
public class Test {
    public static void main(String[] args) {
        handleLicenseAndStart();
    }

    private static void handleLicenseAndStart() {
        // æ£€æŸ¥è®¸å¯è¯å¹¶æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­æˆ‘ä»¬åˆ é™¤äº†å¯¹äº ``handleLicense`` çš„ç›´æ¥è°ƒç”¨ï¼Œåœ¨ ``handleLicenseAndStart`` æ–¹æ³•ä¸­æ£€æŸ¥è®¸å¯è¯å¹¶æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œè¿™æ˜¯æ›´å¥½çš„å†™æ³•ã€‚

---

## ä»£ç æ··æ·†

ä¸ç»è¿‡æ··æ·†é»‘å®¢å‡ ä¹å¯ä»¥æ— æˆæœ¬çš„ç ´è§£æ‚¨çš„æ’ä»¶ï¼ŒéªŒè¯ç³»ç»ŸæŸç§æ„ä¹‰ä¸Šçš„ä¸Šé™ç»å¯¹ä¾èµ–äºäº§å“æ··æ·†çš„å¼ºåº¦ã€‚

åœ¨å®¢æˆ·ç«¯ç¤ºä¾‹ç±» Client ä¸­æˆ‘ä»¬æœ‰æ¨èä¸€äº›çš„å…è´¹ä¸ä»˜è´¹æ··æ·†å™¨ã€‚

è¿™é‡Œä½¿ç”¨ [zelix klassmaster](https://www.zelix.com/klassmaster) è¿›è¡Œæ··æ·†:

Before:

```java
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

public class Test {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }

    public static void calculateFibonacci() {
        int n = 10;
        int first = 0;
        int second = 1;
        System.out.println("Fibonacci Series up to " + n + " terms:");
        for (int i = 1; i <= n; ++i) {
            System.out.print(first + " ");
            int sum = first + second;
            first = second;
            second = sum;
        }
    }

    public static int findNumber(int[] numbers) {
        int max = numbers[0];
        for (int i = 1; i < numbers.length; ++i) {
            if (numbers[i] <= max) continue;
            max = numbers[i];
        }
        return max;
    }

    public static String readFile(String fileName) {
        StringBuilder content = new StringBuilder();
        try (BufferedReader reader = new BufferedReader(new FileReader(fileName))){
            String line;
            while ((line = reader.readLine()) != null) {
                content.append(line).append("\n");
            }
        }
        catch (IOException e) {
            return null;
        }
        return content.toString();
    }
}
```

After:

``` java
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

public class s {
    public static boolean x;
    private static final String[] a;
    private static final String[] b;
    private static final long c;

    public static void main(String[] stringArray) {
        long l = 134872798705237L;
        System.out.println(s.a(2059240770 + (char)-26164, 2059240770 + (char)-1751, (int)l));
    }

    public static void k(long l) {
        int n = (int)c;
        int n2 = x;
        int n3 = 0;
        int n4 = 1;
        System.out.println(s.a(-1176353250 - -26752, -1176353250 - -30076, (int)l) + n + s.a(-1176353250 - -26753, 1176353250 - 27822, (int)l));
        int n5 = 1;
        block0: while (n5 <= n) {
            System.out.print(n3 + " ");
            int n6 = n3 + n4;
            n3 = n4;
            n4 = n6;
            ++n5;
            int n7 = n2;
            while (n7 != 0) {
                int n8 = U.R;
                n7 = ++n8;
                if (l < 0L) continue;
                U.R = n7;
                break block0;
            }
        }
    }

    /*
     * Unable to fully structure code
     */
    public static int L(long var0, int[] var2_1) {
        block15: {
            block14: {
                block9: {
                    block10: {
                        var4_2 = var2_1[0];
                        var3_3 = s.x;
                        var5_4 = 1;
                        while (var5_4 < var2_1.length) {
                            block13: {
                                block12: {
                                    block11: {
                                        v0 = var2_1[var5_4];
                                        v1 = var3_3;
                                        if (var0 < 0L) break block9;
                                        if (v1 != 0) break block10;
                                        v2 = var3_3;
                                        if (var0 <= 0L) break block11;
                                        if (v2 != 0) break block12;
                                        v2 = var4_2;
                                    }
                                    if (v0 <= v2) break block13;
                                    v3 = var2_1[var5_4];
                                }
                                var4_2 = v3;
                            }
                            ++var5_4;
lbl20:
                            // 2 sources

                            ** while (var3_3 != 0)
lbl21:
                            // 1 sources

                        }
lbl22:
                        // 2 sources

                        if (var0 < 0L) ** GOTO lbl20
                        v0 = var4_2;
                    }
                    v1 = U.R;
                }
                if (var0 <= 0L) break block14;
                if (v1 == 0) break block15;
                v1 = var3_3;
            }
            if (var0 >= 0L) {
                v1 = v1 != 0 ? 0 : 1;
            }
            s.x = v1;
        }
        return v0;
    }

    /*
     * Enabled aggressive block sorting
     * Enabled unnecessary exception pruning
     * Enabled aggressive exception aggregation
     */
    public static String a(String string, long l) {
        StringBuilder stringBuilder = new StringBuilder();
        boolean bl = x;
        try {
            BufferedReader bufferedReader;
            block19: {
                bufferedReader = new BufferedReader(new FileReader(string));
                Throwable throwable = null;
                try {
                    String string2;
                    block14: while ((string2 = bufferedReader.readLine()) != null) {
                        stringBuilder.append(string2).append("\n");
                        do {
                            boolean bl2 = bl;
                            if (l >= 0L) {
                                if (bl2) return stringBuilder.toString();
                                bl2 = bl;
                            }
                            if (!bl2) continue block14;
                        } while (l <= 0L);
                    }
                    if (bufferedReader == null) return stringBuilder.toString();
                    if (throwable == null) break block19;
                }
                catch (Throwable throwable2) {
                    try {
                        throwable = throwable2;
                        throw throwable2;
                    }
                    catch (Throwable throwable3) {
                        Throwable throwable4;
                        block20: {
                            if (bufferedReader != null) {
                                if (throwable != null) {
                                    try {
                                        bufferedReader.close();
                                        break block20;
                                    }
                                    catch (Throwable throwable5) {
                                        throwable4 = throwable;
                                        if (l <= 0L) throw throwable4;
                                        throwable4.addSuppressed(throwable5);
                                        if (!bl) break block20;
                                    }
                                }
                                bufferedReader.close();
                            }
                        }
                        throwable4 = throwable3;
                        throw throwable4;
                    }
                }
                try {
                    bufferedReader.close();
                    return stringBuilder.toString();
                }
                catch (Throwable throwable6) {
                    throwable.addSuppressed(throwable6);
                    return stringBuilder.toString();
                }
            }
            bufferedReader.close();
            return stringBuilder.toString();
        }
        catch (IOException iOException) {
            return null;
        }
    }

    /*
     * Unable to fully structure code
     */
    static {
        block15: {
            block14: {
                var7 = new String[3];
                var5_1 = 0;
                var4_2 = "ÂŒ3zÃ±Â³\fqÃ$Ã‘/Ã‡ÂŸÃ–Â¨4Ãn\u0000iÂ¶Ã¿Â¹Â—/lÃ˜\rÂ¦NÃ¾ÃÃ­Ã˜^<Ã•Â„Â«";
                var6_3 = "ÂŒ3zÃ±Â³\fqÃ$Ã‘/Ã‡ÂŸÃ–Â¨4Ãn\u0000iÂ¶Ã¿Â¹Â—/lÃ˜\rÂ¦NÃ¾ÃÃ­Ã˜^<Ã•Â„Â«".length();
                var3_4 = 23;
                var2_5 = -1;
lbl7:
                // 2 sources

                while (true) {
                    continue;
                    break;
                }
lbl9:
                // 1 sources

                while (true) {
                    var7[var5_1++] = new String(v0).intern();
                    if ((var2_5 += var3_4) < var6_3) {
                        var3_4 = var4_2.charAt(var2_5);
                        ** continue;
                    }
                    break block14;
                    break;
                }
                v1 = ++var2_5;
                v2 = var4_2.substring(v1, v1 + var3_4).toCharArray();
                var8_6 = 0;
                v3 = v2.length;
                v4 = v2;
                v5 = v3;
                if (v3 > 1) ** GOTO lbl59
                do {
                    v6 = v4;
                    v7 = v4;
                    v8 = var8_6;
                    while (true) {
                        v9 = v6[v8];
                        switch (var8_6 % 7) {
                            case 0: {
                                v10 = 10;
                                break;
                            }
                            
                            ...
                            
                            default: {
                                v10 = 73;
                            }
                        }
                        v6[v8] = (char)(v9 ^ v10);
                        ++var8_6;
                        v4 = v7;
                        v5 = v5;
                        if (v5 != 0) break;
                        v7 = v4;
                        v11 = v5;
                        v8 = v5;
                        v6 = v4;
                    }
lbl59:
                    // 2 sources

                    v0 = v4;
                    v11 = v5;
                } while (v5 > var8_6);
                ** while (true)
            }
            s.a = var7;
            s.b = new String[3];
            break block15;
lbl69:
            // 1 sources

            while (true) {
                continue;
                break;
            }
        }
        var0_7 = 16056344619883L;
        ** while (true)
        s.c = -1182305448591119519L ^ var0_7;
    }

    private static String a(int n, int n2, int n3) {
        int n4 = (n ^ n3 ^ 0xFFFFA959) & 0xFFFF;
        if (b[n4] == null) {
            int n5;
            int n6;
            char[] cArray = a[n4].toCharArray();
            switch (cArray[0] & 0xFF) {
                case 0: {
                    n6 = 48;
                    break;
                }
                case 1: {
                    n6 = 211;
                    break;
                }
                
                ...
                
                default: {
                    n6 = 203;
                }
            }
            int n7 = n6;
            int n8 = ((n2 ^= n3) & 0xFF) - n7;
            if (n8 < 0) {
                n8 += 256;
            }
            if ((n5 = ((n2 & 0xFFFF) >>> 8) - n7) < 0) {
                n5 += 256;
            }
            int n9 = 0;
            while (n9 < cArray.length) {
                int n10 = n9 % 2;
                int n11 = n9;
                char[] cArray2 = cArray;
                char c = cArray[n11];
                if (n10 == 0) {
                    cArray2[n11] = (char)(c ^ n8);
                    n8 = ((n8 >>> 3 | n8 << 5) ^ cArray[n9]) & 0xFF;
                } else {
                    cArray2[n11] = (char)(c ^ n5);
                    n5 = ((n5 >>> 3 | n5 << 5) ^ cArray[n9]) & 0xFF;
                }
                ++n9;
            }
            s.b[n4] = new String(cArray).intern();
        }
        return b[n4];
    }
}
```

å¸¸è§çš„æ··æ·†æŠ€æœ¯æœ‰:

- åç§°æ··æ·†: æ›´æ”¹å­—æ®µåã€æ–¹æ³•åã€åŒ…åä»¥è¾¾åˆ°æ··æ·†ç›®çš„ã€‚
- å­—ç¬¦ä¸²åŠ å¯†: å¯¹å­—ç¬¦ä¸²å¸¸é‡è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚é€šè¿‡å¯¹ç§°åŠ å¯†ç®—æ³•ã€å¼‚æˆ–è¿ç®—ã€ç§»ä½æ“ä½œæˆ–è‡ªå®šä¹‰çš„æ··æ·†ç®—æ³•å¯¹å­—ç¬¦ä¸²è¿›è¡Œè½¬æ¢ã€‚
- æ§åˆ¶æµæ··æ·†: æ”¹å˜ä»£ç çš„æ§åˆ¶æµç¨‹ï¼Œæ’å…¥æ— ç”¨çš„ä»£ç ç‰‡æ®µã€é‡æ–°æ’åºä»£ç å—ã€å¢åŠ æ¡ä»¶è¯­å¥æˆ–å¾ªç¯ç­‰ã€‚
- æ•°å­—å’Œå¸¸é‡æ··æ·†: å¯¹å¸¸é‡è¿›è¡Œç®—æœ¯è¿ç®—ã€å°†æ•°å­—æ‹†åˆ†ä¸ºå¤šä¸ªè¡¨è¾¾å¼ã€ä½¿ç”¨è¡¨è¾¾å¼ç”Ÿæˆå¸¸é‡ç­‰ã€‚
- ä»£ç ç»“æ„æ··æ·†: æ”¹å˜ä»£ç å—çš„é¡ºåºã€é‡ç»„ä»£ç é€»è¾‘ã€æ’å…¥æ— ç”¨çš„ä»£ç æˆ–é‡å¤çš„ä»£ç å—ç­‰ã€‚

æˆ‘ä»¬å»ºè®®ä½¿ç”¨ä¸€äº›è¾ƒä¸ºå¼ºå¤§çš„æ··æ·†å™¨ï¼ŒProGuard è™½ç„¶ç”¨æˆ·éå¸¸å¤šï¼Œä½†å…¶æ··æ·†åŠ›åº¦å¹¶ä¸å¼ºï¼Œå¯è¯»æ€§éå¸¸é«˜ã€‚

---

## åŸç”Ÿä»£ç 

æˆ‘ä»¬å»ºè®®æ‚¨å°†å…³äºéªŒè¯éƒ¨åˆ†çš„ä»£ç è½¬æ¢ä¸ºåŸç”Ÿ (Native) ä»£ç ï¼Œå¹¶é‡‡ç”¨å…¶ä»–æ··æ·†æŠ€æœ¯è¿›è¡Œè¿›ä¸€æ­¥ä¿æŠ¤ã€‚

åœ¨å®¢æˆ·ç«¯ç¤ºä¾‹ç±» Client ä¸­æˆ‘ä»¬æœ‰æ¨èä¸€äº›çš„å…è´¹ä¸ä»˜è´¹æ··æ·†å™¨ã€‚

åŸç”Ÿä»£ç è½¬æ¢ååœ¨ Java å±‚çœ‹å‡ ä¹ä¸€è‡´ã€‚

Before:

```java
import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;

public class Test {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }

    public static void calculateFibonacci() {
        int n = 10;
        int first = 0;
        int second = 1;
        System.out.println("Fibonacci Series up to " + n + " terms:");
        for (int i = 1; i <= n; ++i) {
            System.out.print(first + " ");
            int sum = first + second;
            first = second;
            second = sum;
        }
    }

    public static int findNumber(int[] numbers) {
        int max = numbers[0];
        for (int i = 1; i < numbers.length; ++i) {
            if (numbers[i] <= max) continue;
            max = numbers[i];
        }
        return max;
    }

    public static String readFile(String fileName) {
        StringBuilder content = new StringBuilder();
        try (BufferedReader reader = new BufferedReader(new FileReader(fileName))) {
            String line;
            while ((line = reader.readLine()) != null) {
                content.append(line).append("\n");
            }
        } catch (IOException e) {
            return null;
        }
        return content.toString();
    }
}
```

After:

```java
public class Test {
    public static native void main(String[] args);

    public static native void calculateFibonacci();

    public static native int findNumber(int[] numbers);

    public static native String readFile(String fileName);
}
```

---

## å¯¹äºç±»åŠ è½½

å°½ç®¡æä¾›äº† API è®©å¼€å‘è€…å¯ä»¥å®ç°è¿œç¨‹åŠ è½½ï¼Œä½†è¿™ä»»ç„¶å­˜åœ¨ä¸€äº›å®‰å…¨éšæ‚£ã€‚

Bad:


ä»äº‘ç«¯ä¸‹è½½æœªæ··æ·†ä¸”ä¸æºå¸¦éªŒè¯ç‰ˆæœ¬çš„å‰¯æœ¬ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹é»‘å®¢å¯ä»¥ä½¿ç”¨æŠ“åŒ…ï¼Œæˆ–è€… Java Agent å®ç° ClassFileTransformer é‡å†™ transform æ–¹æ³•ç­‰æ‰‹æ®µè·å–åˆ°å®Œæ•´å‰¯æœ¬ã€‚

Better:

ä»äº‘ç«¯ä¸‹è½½ç»è¿‡æ··æ·†ä¸”æºå¸¦éªŒè¯ç‰ˆæœ¬çš„å‰¯æœ¬ï¼Œåœ¨å‰¯æœ¬å†…å…¥å£æ–¹æ³•å†è¿›è¡Œä¸€æ¬¡éªŒè¯ã€‚

---